<div id="calendar"></div>

<%= form_tag(class_data_index_path, :method => "get", id: "search-form", :remote => true) do %>
<%= text_field_tag :search, params[:search], placeholder: "Search your major" %>
<%= submit_tag "Search", :name => nil %>
<% end %>

<script>
  window.onload = function () {
    var oTextbox = new AutoSuggestControl(document.getElementById("search"), new StateSuggestions());
  }

  if ($('#calendar').is(':empty')) {
    $('#calendar').fullCalendar({
        handleWindowResize: true,
        defaultDate: moment('2017-01-09'),
        weekends: false,
        header: false,
        height: 501,
        defaultView: "agendaWeek",
        slotMinutes: 10,
        minTime: "08:00:00",
        maxTime: "20:00:00",
        allDaySlot: false,
        events: <%= @chosen_classes %>,
    });
  }

$('#search-form').submit(function(event) {
    event.preventDefault();
    $.ajax({
        type: 'GET',
        url: '/search',
        dataType: 'html',
        data : {
            major: $('#search').val()
        },
        success: function(data) {
            $('#results').html(data);
            return false;
        }
    });
});

$(document.body).on("click", ".card", function() {
    $.ajax({
        type: 'GET',
        url: '/class_data_search',
        dataType: 'html',
        data: {
            id: $(this).attr('id'),
            major: $('#search').val()
        },
        success: function(data) {
            $('#results').html(data);
            return false;
        }
    });
});

$(document.body).on("click", "#back-to-major-btn", function() {
    $.ajax({
        type: 'GET',
        url: '/search',
        dataType: 'html',
        data: {
            major: $(this).attr('major')
        },
        success: function(data) {
            $('#results').html(data);
            return false;
        }
    });
});

$(document.body).on("click", "#independent-class-btn", function() {
    $.ajax({
        type: 'GET',
        url: '/independent_class_data_search',
        dataType: 'html',
        data: {
            id: $(this).attr('independent_class_id'),
            class_id: $(this).attr('class_id'),
            major: $(this).attr('major')
        },
        success: function(data) {
            $('#results').html(data);
            return false;
        }
    });
});

$(document.body).on("click", "#back-to-class-btn", function() {
    $.ajax({
        type: 'GET',
        url: '/class_data_search',
        dataType: 'html',
        data: {
            id: $(this).attr('class_id'),
            major: $(this).attr('major')
        },
        success: function(data) {
            $('#results').html(data);
            return false;
        }
    });
});

</script>

<div id="results" class="col-md-10 col-md-offset-1"></div>

<style> 
div.suggestions {
    -moz-box-sizing: border-box;
    box-sizing: border-box;
    border: 1px solid black;
    position: absolute;   
}

div.suggestions div {
    cursor: default;
    padding: 0px 3px;
}

div.suggestions div.current {
    background-color: #3366cc;
    color: white;
}
</style>